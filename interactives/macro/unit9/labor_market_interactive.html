<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Labor Market Model: WSC, PSC, and AP</title>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f0f0f0;
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 10px;
        }
        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }
        .control-group {
            margin-bottom: 15px;
        }
        .control-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            font-size: 0.9rem;
        }
        input[type=range] {
            width: 100%;
            margin: 8px 0;
        }
        .value-display {
            float: right;
            font-weight: normal;
            color: #666;
        }
        .buttons {
            grid-column: 1 / -1;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
            margin-top: 10px;
        }
        button {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.2s;
            background-color: #e0e0e0;
            color: #333;
        }
        button:hover {
            background-color: #d0d0d0;
        }
        button.active {
            background-color: #007bff;
            color: white;
        }
        .toggles {
            grid-column: 1 / -1;
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            padding-top: 10px;
            border-top: 1px solid #dee2e6;
            margin-top: 10px;
        }
        .toggle-label {
            display: flex;
            align-items: center;
            cursor: pointer;
            font-size: 0.95rem;
        }
        .toggle-label input {
            margin-right: 8px;
            width: 18px;
            height: 18px;
        }
        #chart {
            width: 100%;
            height: 600px;
        }
        .description {
            margin-top: 20px;
            padding: 15px;
            background-color: #e8f4fd;
            border-left: 4px solid #007bff;
            border-radius: 4px;
            line-height: 1.5;
        }
        .stats-panel {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
            padding: 15px;
            background-color: #fff3cd;
            border-radius: 6px;
            border: 1px solid #ffeeba;
            display: none; /* Hidden by default */
        }
        .stat-box {
            text-align: center;
        }
        .stat-value {
            font-size: 1.2rem;
            font-weight: bold;
        }
        .stat-label {
            font-size: 0.85rem;
            color: #666;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>Labor Market Model Interactive</h1>
    
    <div class="controls">
        <div class="control-group">
            <label>Wage Setting Curve (WSC) Base <span id="wsc-val" class="value-display">15</span></label>
            <input type="range" id="wsc-slider" min="0" max="40" step="1" value="15">
            <small>Shifts WSC up/down (Worker Bargaining Power)</small>
        </div>
        
        <div class="control-group">
            <label>Average Product (AP) <span id="ap-val" class="value-display">42</span></label>
            <input type="range" id="ap-slider" min="20" max="60" step="1" value="42">
            <small>Shifts AP line (Productivity)</small>
        </div>
        
        <div class="control-group">
            <label>Profit Margin (Markup) <span id="margin-val" class="value-display">6</span></label>
            <input type="range" id="margin-slider" min="0" max="20" step="0.5" value="6">
            <small>Determines gap between AP and PSC</small>
        </div>

        <div class="toggles">
            <label class="toggle-label">
                <input type="checkbox" id="show-wages" onchange="toggleArea('wages')"> Show Total Wages
            </label>
            <label class="toggle-label">
                <input type="checkbox" id="show-profits" onchange="toggleArea('profits')"> Show Total Profits
            </label>
            <label class="toggle-label">
                <input type="checkbox" id="show-gdp" onchange="toggleArea('gdp')"> Show Total Output (GDP)
            </label>
        </div>

        <div class="buttons">
            <button onclick="setScenario('base')" id="btn-base" class="active">Base Model</button>
            <button onclick="setScenario('recession')" id="btn-recession">Recession (Demand Shock)</button>
            <button onclick="setScenario('covid')" id="btn-covid">COVID-19 Shock</button>
            <button onclick="setScenario('tariffs')" id="btn-tariffs">Tariffs Shock</button>
        </div>
    </div>

    <div id="stats-panel" class="stats-panel">
        <div class="stat-box" id="stat-wages" style="color: #0056b3;">
            <div class="stat-value" id="val-wages">-</div>
            <div class="stat-label">Total Wages</div>
        </div>
        <div class="stat-box" id="stat-profits" style="color: #d9534f;">
            <div class="stat-value" id="val-profits">-</div>
            <div class="stat-label">Total Profits</div>
        </div>
        <div class="stat-box" id="stat-gdp" style="color: #28a745;">
            <div class="stat-value" id="val-gdp">-</div>
            <div class="stat-label">Total Output (GDP)</div>
        </div>
    </div>

    <div id="chart"></div>

    <div id="description" class="description">
        <strong>Base Model:</strong> The equilibrium is where the Wage Setting Curve (WSC) intersects the Price Setting Curve (PSC). With current parameters, structural employment is at <strong>95%</strong>.
    </div>
</div>

<script>
    // Initial State
    const state = {
        wscBase: 15,
        apLevel: 42,
        profitMargin: 6,
        currentScenario: 'base',
        forcedEmployment: null,
        showWages: false,
        showProfits: false,
        showGDP: false
    };

    // DOM Elements
    const wscSlider = document.getElementById('wsc-slider');
    const apSlider = document.getElementById('ap-slider');
    const marginSlider = document.getElementById('margin-slider');
    
    const wscVal = document.getElementById('wsc-val');
    const apVal = document.getElementById('ap-val');
    const marginVal = document.getElementById('margin-val');
    
    const description = document.getElementById('description');
    const buttons = document.querySelectorAll('.buttons button');
    const statsPanel = document.getElementById('stats-panel');

    // Constants
    const WSC_K = 525; 

    // Generate Data
    function generateData() {
        const employment = [];
        const wsc = [];
        const ap = [];
        const psc = [];
        
        const pscLevel = state.apLevel - state.profitMargin;

        for (let n = 0; n <= 99.5; n += 0.5) {
            employment.push(n);
            
            let wscValue = state.wscBase + WSC_K / Math.pow(100 - n, 2);
            if (wscValue > 100) wscValue = null;
            wsc.push(wscValue);
            
            ap.push(state.apLevel);
            psc.push(pscLevel);
        }
        
        return { employment, wsc, ap, psc, pscLevel };
    }

    // Calculate Equilibrium
    function calculateEquilibrium() {
        const pscLevel = state.apLevel - state.profitMargin;

        if (pscLevel <= state.wscBase) return null; 
        
        const term = WSC_K / (pscLevel - state.wscBase);
        if (term < 0) return null;
        
        const n = 100 - Math.sqrt(term);
        return { x: n, y: pscLevel };
    }

    // Update Plot
    function updatePlot() {
        const data = generateData();
        const eq = calculateEquilibrium();
        
        const wscTrace = {
            x: data.employment,
            y: data.wsc,
            mode: 'lines',
            name: 'Wage Setting Curve (WSC)',
            line: { color: '#007bff', width: 3 }
        };
        
        const apTrace = {
            x: data.employment,
            y: data.ap,
            mode: 'lines',
            name: 'Average Product (AP)',
            line: { color: '#28a745', width: 3 }
        };
        
        const pscTrace = {
            x: data.employment,
            y: data.psc,
            mode: 'lines',
            name: 'Price Setting Curve (PSC)',
            line: { color: '#dc3545', width: 3 }
        };

        const traces = [wscTrace, apTrace, pscTrace];
        const shapes = [];
        const annotations = [];

        // Determine current operating point (N, W)
        let currentN = 0;
        let currentW = 0;
        
        if (state.forcedEmployment) {
            currentN = state.forcedEmployment;
            currentW = state.apLevel - state.profitMargin; // Assume sticky wages/prices
        } else if (eq) {
            currentN = eq.x;
            currentW = eq.y;
        }

        // Add Shaded Areas
        if (currentN > 0) {
            // Wages Area: (0,0) to (N, W)
            if (state.showWages) {
                shapes.push({
                    type: 'rect',
                    x0: 0, y0: 0,
                    x1: currentN, y1: currentW,
                    fillcolor: '#007bff', opacity: 0.2,
                    line: { width: 0 }
                });
                annotations.push({
                    x: currentN / 2,
                    y: currentW / 2,
                    text: 'Total Wages',
                    font: { color: '#0056b3', size: 14, weight: 'bold' },
                    showarrow: false
                });
            }

            // Profits Area: (0, W) to (N, AP)
            if (state.showProfits) {
                shapes.push({
                    type: 'rect',
                    x0: 0, y0: currentW,
                    x1: currentN, y1: state.apLevel,
                    fillcolor: '#dc3545', opacity: 0.2,
                    line: { width: 0 }
                });
                annotations.push({
                    x: currentN / 2,
                    y: (currentW + state.apLevel) / 2,
                    text: 'Total Profits',
                    font: { color: '#c82333', size: 14, weight: 'bold' },
                    showarrow: false
                });
            }

            // GDP Area (Total Output): (0,0) to (N, AP)
            // If Wages/Profits are shown, we just use an outline for GDP to avoid muddy colors
            if (state.showGDP) {
                shapes.push({
                    type: 'rect',
                    x0: 0, y0: 0,
                    x1: currentN, y1: state.apLevel,
                    line: { color: '#28a745', width: 3, dash: 'dot' },
                    fillcolor: (state.showWages || state.showProfits) ? 'rgba(0,0,0,0)' : '#28a745',
                    opacity: (state.showWages || state.showProfits) ? 1 : 0.1
                });
                
                // If no other annotations, put GDP in middle. Else put it on top/side
                if (!state.showWages && !state.showProfits) {
                    annotations.push({
                        x: currentN / 2,
                        y: state.apLevel / 2,
                        text: 'Total Output (GDP)',
                        font: { color: '#28a745', size: 16, weight: 'bold' },
                        showarrow: false
                    });
                }
            }
        }

        // Update Stats Panel
        if (currentN > 0 && (state.showWages || state.showProfits || state.showGDP)) {
            statsPanel.style.display = 'flex';
            const totalWages = currentN * currentW;
            const totalProfits = currentN * (state.apLevel - currentW);
            const totalGDP = currentN * state.apLevel;
            
            document.getElementById('val-wages').textContent = totalWages.toFixed(0);
            document.getElementById('val-profits').textContent = totalProfits.toFixed(0);
            document.getElementById('val-gdp').textContent = totalGDP.toFixed(0);

            // Show/Hide individual boxes based on selection
            document.getElementById('stat-wages').style.opacity = state.showWages ? 1 : 0.3;
            document.getElementById('stat-profits').style.opacity = state.showProfits ? 1 : 0.3;
            document.getElementById('stat-gdp').style.opacity = state.showGDP ? 1 : 0.3;
            
        } else {
            statsPanel.style.display = 'none';
        }

        // Add equilibrium point
        if (eq && eq.x >= 0 && eq.x <= 100) {
            const isEquilibriumActive = !state.forcedEmployment;
            
            traces.push({
                x: [eq.x],
                y: [eq.y],
                mode: 'markers',
                name: 'Structural Equilibrium',
                marker: { 
                    color: isEquilibriumActive ? 'black' : 'rgba(0,0,0,0.3)', 
                    size: 12, 
                    symbol: 'circle' 
                },
                hoverinfo: 'text',
                text: [`Equilibrium: N=${eq.x.toFixed(1)}%, W/P=${eq.y}`]
            });
            
            if (isEquilibriumActive) {
                traces.push({
                    x: [eq.x, eq.x],
                    y: [0, eq.y],
                    mode: 'lines',
                    showlegend: false,
                    line: { color: 'gray', width: 1, dash: 'dash' },
                    hoverinfo: 'none'
                });
            }
        }

        // Add Forced Employment Point
        if (state.forcedEmployment) {
            const pscLevel = state.apLevel - state.profitMargin;
            traces.push({
                x: [state.forcedEmployment],
                y: [pscLevel],
                mode: 'markers',
                name: 'Actual Employment',
                marker: { color: 'red', size: 14, symbol: 'x' },
                hoverinfo: 'text',
                text: [`Actual Employment: ${state.forcedEmployment}%`]
            });

             traces.push({
                x: [state.forcedEmployment, state.forcedEmployment],
                y: [0, pscLevel],
                mode: 'lines',
                showlegend: false,
                line: { color: 'red', width: 2, dash: 'dash' },
                hoverinfo: 'none'
            });

            // Gap
            if (eq) {
                // Only show gap shading if we aren't showing wages/profits/GDP area shading to avoid clutter
                // OR layer it differently. Let's keep it but make it hashed or distinct.
                // Actually, if we show areas, the gap is naturally the empty space.
                // But let's keep the explicit gap marker if areas are OFF, or make it subtle.
                if (!state.showWages && !state.showProfits && !state.showGDP) {
                    shapes.push({
                        type: 'rect',
                        xref: 'x', yref: 'paper',
                        x0: state.forcedEmployment, y0: 0,
                        x1: eq.x, y1: 1,
                        fillcolor: 'red', opacity: 0.1,
                        line: { width: 0 }
                    });
                    annotations.push({
                        x: (state.forcedEmployment + eq.x) / 2,
                        y: pscLevel / 2,
                        text: 'Unemployment Gap',
                        font: { color: 'red' },
                        showarrow: false
                    });
                }
            }
        }

        // Full Employment Line
        traces.push({
            x: [100, 100],
            y: [0, 100],
            mode: 'lines',
            name: 'Full Employment',
            line: { color: 'gray', width: 1, dash: 'dot' },
            hoverinfo: 'none'
        });

        const layout = {
            title: 'Labor Market Equilibrium',
            xaxis: {
                title: 'Employment (N)',
                range: [0, 105],
                fixedrange: true
            },
            yaxis: {
                title: 'Real Wage (W/P)',
                range: [0, 80],
                fixedrange: true
            },
            hovermode: 'closest',
            showlegend: true,
            legend: { orientation: 'h', y: -0.2 },
            margin: { l: 60, r: 30, t: 50, b: 80 },
            paper_bgcolor: 'white',
            plot_bgcolor: 'white',
            shapes: shapes,
            annotations: annotations
        };
        
        layout.xaxis.showgrid = true;
        layout.yaxis.showgrid = true;
        layout.xaxis.gridcolor = '#f0f0f0';
        layout.yaxis.gridcolor = '#f0f0f0';

        Plotly.newPlot('chart', traces, layout, {responsive: true, displayModeBar: false});
    }

    // Event Listeners
    wscSlider.addEventListener('input', (e) => {
        state.wscBase = parseFloat(e.target.value);
        wscVal.textContent = state.wscBase;
        state.currentScenario = 'custom';
        state.forcedEmployment = null;
        updateButtons();
        updateDescription();
        updatePlot();
    });

    apSlider.addEventListener('input', (e) => {
        state.apLevel = parseFloat(e.target.value);
        apVal.textContent = state.apLevel;
        state.currentScenario = 'custom';
        state.forcedEmployment = null;
        updateButtons();
        updateDescription();
        updatePlot();
    });

    marginSlider.addEventListener('input', (e) => {
        state.profitMargin = parseFloat(e.target.value);
        marginVal.textContent = state.profitMargin;
        state.currentScenario = 'custom';
        state.forcedEmployment = null;
        updateButtons();
        updateDescription();
        updatePlot();
    });

    function toggleArea(type) {
        if (type === 'wages') state.showWages = document.getElementById('show-wages').checked;
        if (type === 'profits') state.showProfits = document.getElementById('show-profits').checked;
        if (type === 'gdp') state.showGDP = document.getElementById('show-gdp').checked;
        updatePlot();
    }

    function updateButtons() {
        buttons.forEach(btn => {
            if (btn.id === `btn-${state.currentScenario}`) {
                btn.classList.add('active');
            } else {
                btn.classList.remove('active');
            }
        });
    }

    function updateDescription() {
        let text = "";
        if (state.currentScenario === 'base') {
            text = "<strong>Base Model:</strong> The equilibrium is where the Wage Setting Curve (WSC) intersects the Price Setting Curve (PSC). <br>Structural employment is now at <strong>95%</strong>.";
        } else if (state.currentScenario === 'recession') {
            text = "<strong>Recession (Demand Shock):</strong> In a demand-deficient recession, the curves <em>do not shift</em>. <br>The economy moves off the equilibrium to a point of lower employment (e.g., 80%) due to low aggregate demand.";
        } else if (state.currentScenario === 'covid') {
            text = "<strong>COVID-19 Shock:</strong> <br>1. <strong>WSC shifts UP</strong> (health risks). <br>2. <strong>AP shifts DOWN</strong> (productivity falls). <br>3. <strong>Profit Margin increases</strong> (less competition). <br>Result: PSC shifts down significantly, leading to lower employment and wages.";
        } else if (state.currentScenario === 'tariffs') {
            text = "<strong>Tariffs Shock:</strong> <br>1. <strong>Profit Margin increases</strong> drastically because tariffs reduce foreign competition. <br>2. This pushes the PSC down. <br>Result: Lower equilibrium employment and lower real wages.";
        } else {
            text = "<strong>Custom Scenario:</strong> Adjust the sliders. Note that PSC = AP - Profit Margin.";
        }
        description.innerHTML = text;
    }

    function setScenario(scenario) {
        state.currentScenario = scenario;
        state.forcedEmployment = null;
        
        if (scenario === 'base') {
            state.wscBase = 15;
            state.apLevel = 42;
            state.profitMargin = 6; 
        } else if (scenario === 'recession') {
            state.wscBase = 15;
            state.apLevel = 42;
            state.profitMargin = 6;
            state.forcedEmployment = 80; 
        } else if (scenario === 'covid') {
            state.wscBase = 20; 
            state.apLevel = 38; 
            state.profitMargin = 8; 
        } else if (scenario === 'tariffs') {
            state.wscBase = 15;
            state.apLevel = 42;
            state.profitMargin = 12; 
        }

        // Update UI
        wscSlider.value = state.wscBase;
        apSlider.value = state.apLevel;
        marginSlider.value = state.profitMargin;
        
        wscVal.textContent = state.wscBase;
        apVal.textContent = state.apLevel;
        marginVal.textContent = state.profitMargin;

        updateButtons();
        updateDescription();
        updatePlot();
    }

    // Initialize
    updatePlot();

</script>

</body>
</html>